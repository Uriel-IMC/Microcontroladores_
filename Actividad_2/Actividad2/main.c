//
// ???       ??????  ????????? ??? ???   ?? ??????????  ???      ???????     ??? ???
// ??????    ???? ??  ?  ??? ??????????   ?????????? ?????????    ???? ???   ????????
// ???  ???  ???    ? ? ???? ?????? ???  ??????????   ?????  ???  ???   ??   ????????
// ????????? ???? ????? ???? ? ????  ??? ???????????   ?????????? ????   ?   ????????
// ??   ????? ????? ?  ???? ? ????   ????  ???????????  ??   ???????????    ????????
// ??   ????? ?? ?  ?  ? ??   ??     ? ??  ??   ???  ?  ??   ???? ???  ?    ??  ??
// ?   ?? ?  ?  ?       ?     ? ?   ? ??   ? ? ? ?  ?   ?   ?? ? ? ?  ?     ? ? ? ?
// ?   ?   ?          ?       ? ?     ??   ? ? ? ?  ?   ?   ?    ? ?  ?     ? ? ? ?
// ?  ?? ?                ?        ?   ?     ?          ?  ?   ?        ?   ?
// ?                          ?        ?                 ?
//

#include <avr/io.h>
#include <string.h>
#include <util/delay.h>
#include "i2c.h"
#include "lcd_i2c.h"

int main(void)
{
	// *** LCD Initialization ***
	
	init_i2c();
	lcd_i2c_init();

	// *** Constants ***
	
	int DELAY_TIME = 200;
	
	// displacement length. This means the number of words that fit across the width of the screen.
	int SHIFT_LEN = 16;
	
	// *** Variables ***
	
	// 64 characters message generated by https://loremipsum.io/generator/
	char msg[] = "in mollis nunc sed id semper risus in hendrerit gravida rutrum quisque non tellus orci ac auctor augue mauris augue neque gravida in fermentum et sollicitudin ac orci phasellus egestas tellus rutrum tellus pellentesque eu tincidunt tortor aliquam nulla facilisi cras fermentum odio eu feugiat pretium nibh ipsum consequat nisl vel pretium lectus quam id leo in vitae turpis massa sed elementum tempus egestas";
	
	// With this "strlen" we dynamically obtain the length of the message
	int msg_len = strlen(msg);
	int i = 0;
	
	// *** code implementation ***

	while (1) {
		// First of all, we must clean the screen so that the words do not appear on top of it.
		lcd_i2c_clr();

		// positions one character for each column of the first row
		for (int j = 0; j < SHIFT_LEN; j++) {
			// We use the "modulo" operator to avoid going beyond the maximum index of our text string
			// See the following link to delve deeper into the topic:
			// https://www.geeksforgeeks.org/modulo-operator-in-c-cpp-with-examples/
			lcd_i2c_col_row(j + 1, 1);
			lcd_i2c_data(msg[i % msg_len]);
			i++;
			_delay_ms(DELAY_TIME);
		}

		// positions one character for each column of the second row
		for (int j = 0; j < SHIFT_LEN; j++) {
			lcd_i2c_col_row(j + 1, 2);
			lcd_i2c_data(msg[i % msg_len]);
			i++;
			_delay_ms(DELAY_TIME);
		}
	}
}

